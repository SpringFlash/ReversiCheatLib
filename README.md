# ReversiCheatLib - Улучшенная версия

Библиотека для игры в Реверси (Отелло) с улучшенными алгоритмами принятия решений.

## Основные улучшения

1. **Оптимизированные алгоритмы:**

   - **MCTS (Monte Carlo Tree Search):**

     - Адаптивное количество итераций в зависимости от фазы игры
     - Приоритеты для ходов в углы и края
     - Эвристический выбор ходов для симуляции
     - Оптимизированный параметр "исследование/эксплуатация"
     - Ограничение глубины симуляции для увеличения производительности

   - **NegaScout:**

     - Таблица транспозиций для кеширования результатов
     - Эвристическое упорядочивание ходов
     - Нулевое окно для ускорения поиска
     - Итеративное углубление
     - Оптимизированное обрезание alpha-beta
     - Адаптивная глубина поиска по фазам игры

   - **Minimax:**
     - Улучшенная эвристика для оценки позиции
     - Оптимизация для конечной фазы игры

2. **Улучшенная эвристическая функция оценки:**

   - Оптимизированные весовые таблицы для различных фаз игры
   - Учёт угловых позиций с повышенными весами
   - Негативные веса для опасных клеток рядом с углами
   - Учёт мобильности (количество доступных ходов)
   - Оценка стабильных фишек (которые нельзя перевернуть)
   - Паритет в конечной фазе игры
   - Оценка диагоналей и паттернов

3. **Умная стратегия выбора алгоритмов:**

   - MCTS для ранней стадии (больше исследования)
   - NegaScout для средней стадии (баланс скорости и качества)
   - Minimax для поздней стадии (точный расчёт)
   - Приоритетный захват углов
   - Предотвращение ходов, дающих противнику доступ к углам

4. **Улучшенное логирование и анализ:**
   - Детальная запись каждого хода и состояния доски
   - Статистика по используемым алгоритмам
   - Фиксация времени на принятие решений
   - Оценка качества принятых решений

## Особенности реализации

- Тщательно оптимизированы алгоритмы для работы в ограниченное время
- Адаптивные параметры в зависимости от стадии игры
- Современные методы оценки позиции на основе исследований по игре Реверси
- Улучшенная обработка особых ситуаций (нет ходов, конец игры)

## Использование

Для запуска автоматической игры используйте команду:

```
python src/process_image.py --auto-play [координаты игрового поля] [задержка]
```

Для тестирования алгоритмов:

```
python src/test_algorithms.py
```

## Результаты

Новая версия алгоритмов показывает значительное улучшение в игре против стандартных противников:

- Захват углов на ранней стадии
- Контроль краёв и диагоналей
- Устойчивость против стандартных тактик
- Эффективное использование времени на ход

## Новые возможности

### Улучшенная архитектура с разделением логики игры

Логика игры вынесена в отдельный модуль `reversi_logic.py`, что повышает модульность кода и упрощает его повторное использование и тестирование.

### Усовершенствованный алгоритм игры

Реализован продвинутый алгоритм принятия решений, основанный на последних исследованиях оптимальной игры в Отелло:

- **Альфа-бета поиск** с динамической глубиной в зависимости от стадии игры
- **Оптимальная последовательность ходов** на основе академических исследований
- **Транспозиционная таблица** для кэширования результатов поиска и ускорения работы
- **Улучшенная эвристика оценки позиции**:
  - Повышенные веса угловых клеток и краёв доски
  - Анализ мобильности (количество доступных ходов)
  - Учёт стабильных фишек, которые нельзя перевернуть
  - Различные стратегии на разных стадиях игры

### Режим анализа доски (только логика)

Теперь вы можете использовать только логику игры для анализа доски без автоматических кликов:

```
python src/play_reversi.py --logic-only --board-file examples/board_example.json
```

Для этого режима нужно подготовить JSON-файл с состоянием доски в следующем формате:

```json
{
  "board": [
    ["empty", "empty", "empty", "empty", "empty", "empty", "empty", "empty"],
    ["empty", "empty", "empty", "empty", "empty", "empty", "empty", "empty"],
    ["empty", "empty", "empty", "empty", "black", "empty", "empty", "empty"],
    ["empty", "empty", "empty", "white", "black", "empty", "empty", "empty"],
    ["empty", "empty", "empty", "black", "white", "empty", "empty", "empty"],
    ["empty", "empty", "empty", "empty", "empty", "empty", "empty", "empty"],
    ["empty", "empty", "empty", "empty", "empty", "empty", "empty", "empty"],
    ["empty", "empty", "empty", "empty", "empty", "empty", "empty", "empty"]
  ],
  "player_color": "black"
}
```

### Полностью автономный режим (только Python)

Теперь вы можете запускать игру полностью из Python, без необходимости использовать JavaScript:

```
python src/play_reversi.py
```

#### Параметры командной строки

- `--window` или `-w`: Название окна игры (по умолчанию: "Удаленное управление - ANT DAO TECHNOLOGY LIMITED R2022")
- `--interval` или `-i`: Интервал между ходами в секундах (по умолчанию: 3.0)
- `--delay` или `-d`: Задержка перед кликом в секундах (по умолчанию: 0.5)
- `--max-moves` или `-m`: Максимальное количество ходов (по умолчанию: без ограничений, 0 также означает без ограничений)
- `--border-top` или `-bt`: Верхний отступ в пикселях для удаления рамки с заголовком (по умолчанию: 45)
- `--border-left` или `-bl`: Левый отступ в пикселях для удаления боковой рамки (по умолчанию: 10)
- `--border-bottom` или `-bb`: Нижний отступ в пикселях для удаления нижней части интерфейса (по умолчанию: 70)

Пример с параметрами:

```
python src/play_reversi.py --window "Удаленное управление - ANT DAO TECHNOLOGY LIMITED R2022" --interval 2.5 --delay 0.3 --border-top 45 --border-left 10 --border-bottom 70
```

### Использование через Node.js (устаревший способ)

Если вы предпочитаете использовать интерфейс Node.js, вы можете запустить:

```
node src/window-player-win.js
```

#### Доступные команды:

- `window <название>` - Установить название целевого окна
- `list` или `list-windows` - Показать список всех окон
- `s` - Запустить автоматическую игру
- `stop` - Остановить автоматическую игру
- `interval <seconds>` - Изменить интервал между ходами (в секундах)
- `1` - Сделать один ход
- `status` - Показать текущий статус
- `help` - Показать справку по командам
- `exit` - Выйти из программы

## Требования

Для работы библиотеки требуется:

- Python 3.8 или выше
- Библиотеки из requirements.txt

## Установка

1. Клонируйте репозиторий:

```bash
git clone https://github.com/yourusername/ReversiCheatLib.git
cd ReversiCheatLib
```

2. Установите зависимости:

```bash
pip install -r requirements.txt
```

## Использование

Библиотека предоставляет несколько режимов работы:

### 1. Игра в окне

Этот режим позволяет играть в реверси в указанном окне, автоматически определяя доску и делая ходы:

```bash
python src/main.py window --title "Название окна" --interval 3.0
```

Где:

- `--title` - название окна (по умолчанию "Удаленное управление - ANT DAO TECHNOLOGY LIMITED R2022")
- `--interval` - интервал между ходами в секундах (по умолчанию 3.0)

Для запуска интерактивного режима с возможностью управления:

```bash
python src/main.py window --interactive
```

### 2. Анализ изображения

Этот режим анализирует изображение доски и выводит информацию о текущей позиции:

```bash
python src/main.py image --path "путь/к/изображению.png"
```

### 3. Игра против ИИ

Этот режим позволяет играть против ИИ:

```bash
python src/main.py ai --algorithm negascout --depth 5
```

Доступные алгоритмы:

- random - случайные ходы
- minimax - алгоритм минимакс
- negamax - алгоритм негамакс
- negascout - алгоритм негаскаут (по умолчанию)
- mcts - поиск по дереву Монте-Карло

## Структура проекта

- `src/` - исходный код библиотеки
  - `main.py` - главный модуль для запуска
  - `window_player.py` - игра в указанном окне
  - `process_image.py` - обработка изображений и определение доски
  - `reversi_logic.py` - логика игры и алгоритмы
  - `play_reversi.py` - интерфейс для игры против ИИ
  - `mcts.py` - реализация алгоритма MCTS
  - `negascout.py` - реализация алгоритма NegaScout
  - `heuristics.py` - эвристические функции оценки
  - `board.py` - представление доски
  - `analyze_logs.py` - анализ логов игры
- `logs/` - логи игр
- `examples/` - примеры использования
- `test_images/` - тестовые изображения для отладки
- `best-games/` - сохраненные лучшие игры

## Как это работает

1. Скрипт находит окно с игрой по его названию
2. Захватывает изображение окна
3. Анализирует игровое поле и определяет текущее состояние доски
4. Определяет цвет игрока
5. Находит лучший ход с помощью алгоритма Реверси
6. Выполняет клик по выбранной клетке
7. Повторяет процесс с заданным интервалом

## Особенности алгоритма принятия решений

Наш алгоритм основан на исследованиях оптимальной игры в Отелло и использует следующие принципы:

1. **Стратегия в зависимости от стадии игры**:

   - В начале игры: фокус на получение стратегически важных позиций и мобильности
   - В середине игры: баланс между позицией, мобильностью и стабильными фишками
   - В конце игры: максимизация количества фишек и захват ключевых позиций

2. **Особое значение углов и краев**:

   - Захват углов дает значительное преимущество
   - Избегание ходов в клетки, прилегающие к углам, если угол еще не занят
   - Укрепление стабильных линий фишек по краям

3. **Важность мобильности**:

   - Сохранение высокой мобильности (возможных ходов) для себя
   - Ограничение мобильности противника
   - Создание "ловушек", вынуждающих противника делать невыгодные ходы

4. **Оптимальная последовательность ходов**:
   - В начале игры алгоритм следует оптимальной последовательности ходов
   - На основе исследований подтверждено, что эта последовательность приводит к ничьей или победе

## Если игра не распознается

Если у вас возникают проблемы с распознаванием игрового поля, попробуйте выполнить следующие шаги:

1. Убедитесь, что игровое поле хорошо видно и не перекрыто другими окнами
2. Попробуйте изменить название окна в параметрах (используйте команду `list-windows` в режиме Node.js)
3. Проверьте, что в окне нет лишних элементов, которые могут помешать распознаванию доски
4. Настройте параметры отступов (`--border-top`, `--border-left`, `--border-bottom`), чтобы точно вырезать только игровое поле без рамок и нижней части интерфейса

### Настройка отступов

Для разных окон и разрешений экрана могут потребоваться разные значения отступов. Экспериментируйте с параметрами:

- Увеличьте `--border-top`, если захватывается слишком много заголовка окна
- Уменьшите `--border-top`, если обрезается верхняя часть игрового поля
- Увеличьте `--border-bottom`, если захватывается нижняя панель с кнопками
- Увеличьте `--border-left`, если захватываются боковые рамки окна

### Последние обновления

- **Улучшено**: Реализован продвинутый алгоритм принятия решений с альфа-бета поиском и транспозиционной таблицей
- **Добавлено**: Оптимальная последовательность ходов на основе исследований решения игры Отелло
- **Исправлено**: Корректные координаты клика - теперь скрипт правильно учитывает отступы при выполнении клика
- **Исправлено**: Запуск без указания параметра max_moves - теперь скрипт корректно запускается без ограничения максимального количества ходов
- **Исправлено**: Исправлен баг с координатами клика - теперь координаты правильно рассчитываются относительно окна, а не экрана
- **Добавлено**: Настраиваемые отступы (--border-top, --border-left, --border-bottom) для точного определения области игрового поля
- **Улучшено**: Распознавание игровой доски и определение возможных ходов
