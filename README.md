# Reversi Bot Native

–ù–∞—Ç–∏–≤–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏–≥—Ä—ã –≤ —Ä–µ–≤–µ—Ä—Å–∏ (Othello) –ø–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞–º –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç OpenCV –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä—è–º–æ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ, –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üöÄ –ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- üîí –†–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ, –±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- üì± –ü–æ–¥–¥–µ—Ä–∂–∫–∞ iOS –∏ Android
- üéØ –¢–æ—á–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –¥–ª—è –∫–ª–∏–∫–∞
- üéÆ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –∏–≥—Ä–æ–∫–∞
- üß† –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ò–ò –¥–ª—è –≤—ã–±–æ—Ä–∞ –ª—É—á—à–µ–≥–æ —Ö–æ–¥–∞

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- React Native >= 0.60.0
- iOS:
  - iOS 11.0 –∏–ª–∏ –≤—ã—à–µ
  - Xcode 12.0 –∏–ª–∏ –≤—ã—à–µ
  - CocoaPods
- Android:
  - minSdkVersion 21
  - compileSdkVersion 31
  - NDK

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ npm
npm install @reversi/bot-native

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ yarn
yarn add @reversi/bot-native
```

### iOS

1. –î–æ–±–∞–≤—å—Ç–µ OpenCV –≤ –≤–∞—à `Podfile`:

```ruby
pod 'OpenCV', '~> 4.7.0'
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
cd ios && pod install
```

3. –î–æ–±–∞–≤—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤ `Info.plist`:

```xml
<key>NSCameraUsageDescription</key>
<string>–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è</string>
<key>NSPhotoLibraryUsageDescription</key>
<string>–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∏–≥—Ä—ã</string>
```

### Android

1. –î–æ–±–∞–≤—å—Ç–µ OpenCV –≤ `android/app/build.gradle`:

```gradle
android {
    defaultConfig {
        // ...
        ndk {
            abiFilters "armeabi-v7a", "arm64-v8a", "x86", "x86_64"
        }
    }
}

dependencies {
    implementation 'org.opencv:opencv-android:4.7.0'
}
```

2. –î–æ–±–∞–≤—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤ `AndroidManifest.xml`:

```xml
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```typescript
import { ReversiClient } from "@reversi/bot-native";
import { captureScreen } from "react-native-view-shot";

const analyzeGame = async () => {
  try {
    // –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç
    const uri = await captureScreen({
      format: "jpg",
      quality: 0.8,
    });

    // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∏–µ–Ω—Ç–∞
    const client = new ReversiClient();

    // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç
    const result = await client.analyzeScreenshot(uri);

    if (result.success && result.hasMove) {
      const { x, y } = result.move.screen_coordinates;
      const { row, col, score } = result.move;

      console.log(`–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ö–æ–¥: ${col}${row} (–æ—Ü–µ–Ω–∫–∞: ${score})`);
      console.log(`–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –∫–ª–∏–∫–∞: (${x}, ${y})`);
    }
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞:", error);
  }
};
```

## API

### ReversiClient

#### Methods

```typescript
analyzeScreenshot(imageUri: string): Promise<AnalysisResult>
```

#### Types

```typescript
interface AnalysisResult {
  success: boolean;
  hasMove: boolean;
  message?: string;
  move?: {
    row: number;
    col: string;
    score: number;
    screen_coordinates: {
      x: number;
      y: number;
    };
  };
  board?: {
    state: BoardState;
    playerColor: "black" | "white";
  };
}

interface BoardState {
  [key: number]: {
    [key: number]: "black" | "white" | "empty";
  };
}
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

1. **–ö–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**

   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è quality >= 0.8)
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–∏–¥–Ω–æ
   - –ò–∑–±–µ–≥–∞–π—Ç–µ –±–ª–∏–∫–æ–≤ –∏ —Ç–µ–Ω–µ–π –Ω–∞ —ç–∫—Ä–∞–Ω–µ

2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

   - –î–æ–±–∞–≤—å—Ç–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ –≤—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞
   - –ö—ç—à–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–æ—Å–∫–∏
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**

   - –í—Å–µ–≥–¥–∞ –æ–±–æ—Ä–∞—á–∏–≤–∞–π—Ç–µ –≤—ã–∑–æ–≤—ã –≤ try-catch
   - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ result.success –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
   - –î–æ–±–∞–≤—å—Ç–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–ª—è —Å–ª—É—á–∞–µ–≤ –Ω–µ—É–¥–∞—á–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è

4. **–†–∞–∑—Ä–µ—à–µ–Ω–∏—è**
   - –ó–∞–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ —Å–ª—É—á–∞–∏ –æ—Ç–∫–∞–∑–∞ –≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è—Ö
   - –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–Ω—è—Ç–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, –∑–∞—á–µ–º –Ω—É–∂–Ω—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è

## –û—Ç–ª–∞–¥–∫–∞

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å–æ–∑–¥–∞–µ—Ç –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

- `debug_original.png` - –∏—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- `debug_gray.png` - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –æ—Ç—Ç–µ–Ω–∫–∞—Ö —Å–µ—Ä–æ–≥–æ
- `debug_thresh.png` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Ä–æ–≥–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `debug_board.png` - –Ω–∞–π–¥–µ–Ω–Ω–æ–µ –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ —Å —Ä–∞–∑–º–µ—Ç–∫–æ–π

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. –ù–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
2. –ü—Ä–∏ –æ—á–µ–Ω—å —è—Ä–∫–æ–º –æ—Å–≤–µ—â–µ–Ω–∏–∏ –≤–æ–∑–º–æ–∂–Ω—ã –ª–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è
3. –ù–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö —Å –º–∞–ª–µ–Ω—å–∫–∏–º —ç–∫—Ä–∞–Ω–æ–º –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –æ–±–ª–∞—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑–∞

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
